# FOX SPIRIT ROMANCE: AFFINITY VARIABLE ANALYSIS
## Implementation: iDkP from GaragePixel
## Date: 2025-04-10 08:15:46
## Aida Version: 4.2.1

## Purpose
This technical document identifies key variables in the PreFusedMainStoryTree that track player behavior metrics and relationship dynamics, focusing specifically on Hikari's interactions with Katsuo and the Katsuo-Megumi relationship variables that determine automatic endings.

## List of Functionality
1. **Player Behavior Tracking**
   - Affinity measurement system
   - Interaction outcome recording
   - Behavior pattern analysis
   - Relationship status evaluation

2. **Automatic Ending Determination**
   - Katsuo-Megumi interaction variables
   - Threshold-based outcome calculation
   - Independent progression tracking
   - Player-independent scenario evaluation

3. **Choice-Based Branching**
   - Direct player decision recording
   - Branch selection determination
   - Path availability calculation
   - Decision consequence implementation

4. **Optimization Opportunity Assessment**
   - Variable consolidation potential
   - Scoring pattern integration
   - Redundancy elimination opportunities
   - System simplification framework

## Notes: Implementation Choices
This analysis focuses on the core variables that evaluate player behavior as Hikari toward Katsuo (primary affinity metric) and the separate variables tracking Katsuo-Megumi interactions that determine automatic endings. The implementation maintains simplicity by identifying only essential variables requiring optimization while preserving the straightforward evaluation mechanics currently implemented.

## Technical Advantages
1. **Simplified Evaluation Architecture**
   The implementation maintains straightforward evaluation mechanics through focused variable tracking. By isolating specific affinity metrics for Hikari-Katsuo interactions, the system creates clean behavior evaluation without unnecessary complexity. The specific implementation of dedicated tracking variables creates clear relationship status visualization without requiring complex calculation frameworks.

2. **Automatic Ending Determination Framework**
   The separate tracking system for Katsuo-Megumi interactions creates elegant automatic ending determination independent of player choices. This implementation maintains narrative coherence through background relationship progression while preserving player agency within their character's scope. The specific variable implementation allows story branches to unfold naturally based on established character relationships without requiring explicit player intervention.

3. **Choice Integration Framework**
   The implementation creates seamless integration between direct player choices and ongoing variable tracking. This framework allows meaningful consequences from both explicit decisions and cumulative behavior patterns. The specific implementation balances immediate choice impact with long-term relationship development through complementary variable systems that collectively determine story progression.

# IDENTIFIED VARIABLES FOR OPTIMIZATION

After analyzing the PreFusedMainStoryTree, these key variables require optimization:

1. **+hikari_affinity**
   - Primary metric tracking Hikari's behavior toward Katsuo
   - Determines key relationship thresholds for story branches
   - Used in festival chapter affinity check (<10/10+)

2. **+katsuo_megumi_relationship**
   - Tracks Katsuo-Megumi interaction outcomes
   - Determines automatic ending paths regardless of player choice
   - Referenced in multiple ending determination points

3. **+player_choices**
   - Direct tracking of explicit player decisions
   - Used alongside affinity for branch availability
   - Determines immediate consequence pathways

The visual novel mechanics remain simple as intended, with two primary systems:
1. Player behavior evaluation (how Hikari acts toward Katsuo)
2. Automatic progression tracking (Katsuo-Megumi interactions)

Additional direct player choices create the third component of the branching system, completing the straightforward structure of the visual novel mechanics.
